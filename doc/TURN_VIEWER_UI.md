# ターン再生ビューワー — 画面設計書

目的  
ptcgl 形式の試合ログ／解析JSONを1ターン（先攻・後攻）単位で視覚的に再生する。添付資料のテーブル上からの俯瞰イメージを参照し、カード移動やダメージなどをアニメで表示する。

1. 全体レイアウト（デスクトップ想定、画面横幅: 1280px 以上）
- ヘッダー（上部、固定）
  - ファイル名 / 試合名
  - 現在ターン表示（例: Turn 3）
  - 先攻 / 後攻強調バッジ（色差で識別）
  - 残りサイド数（先攻プレイヤー右上、後攻プレイヤー左下に表示）
- メイン領域（左右二段の俯瞰テーブル）
  - 中央プレイテーブル（上下２エリア）
    - 上エリア：先攻プレイヤー側（画面向かって上）
      - バトル場（アクティブカード表示：カード名、HP、ダメージ、特殊状態、装備）
      - ベンチ（最大5スロット、空きスロットをグレーで表示）
      - 手札プレビュー（枚数と任意展開で中身表示）
      - プライズ山（小さいカードアイコンで残り枚数）
    - 中央：スタジアム表示、共有情報（ターンフェーズ、タイマー）
    - 下エリア：後攻プレイヤー側（先攻と同構成）
  - 画面左右にプレイヤーのプレイヤーパネル（顔写真／名前／デッキ名等）
- 下部コントロールバー
  - Back / Next ボタン（主要）
  - Auto（速度調整スライダー） / Pause
  - スライダー（ターン選択） + プレイヤー切替（先攻/後攻）
  - 現在アクションのテキストログ（raw 表示、クリックで詳細）
  - ステップ（Action単位）ボタン（詳細モード）

2. 表示要素詳細
- カード表現
  - 小アイコン＋ラベル（カード名、HP、ダメージ数、エネ数、特殊状態アイコン）
  - 進化は重なりアニメで表現（下に親カード）
- アニメーション
  - カード移動（縮小→移動→拡大）、エネルギー付与はピンで吸着、KOはフェード+崩れ
  - プライズ取得は右上カードアイコンが1つ減る演出
  - 進化、装備、サポート使用はバナー通知（短時間中央上表示）
- 状態スナップショット
  - ターン開始（先攻）、先攻終了、後攻終了 の各スナップショットを保持
  - Back はスナップショット復元（逆アニメは必要に応じて簡易化）

3. 操作フロー（Next動作）
- Next を押す → 現在表示プレイヤーの actions[] を順にアニメ再生
- すべて再生後に停止（次押下で相手側を再生）
- Auto は Next を自動発火（ユーザーが指定したmsごと）

4. コンポーネント分割（React想定）
- App
  - Header
  - PlayerPanel (先攻／後攻)
  - PlayTable (ActiveArea, Bench, Stadium, Prize)
  - Controls (Next, Back, Auto, Slider)
  - ActionLog
- state: { parsedJson, currentTurn, currentSide ('first'|'second'), snapshots, playing, speed }

5. データ/結合
- 入力: doc/logsample/parsed/*.json
- 各 action のtype で UI 操作を決定（draw, play, attach, evolve, attack, knockout, other）
- raw テキストはフォールバックで画面に表示

6. アセット
- カード画像：まずはカード名テキスト。将来的にカード名→画像マッピング（外部API or local assets）
- アイコン：エネルギー、特殊状態、装備、プライズ

7. レスポンシブ / アクセシビリティ
- 画面幅が狭い場合は左右を縦積みにして中央テーブルをスクロール
- キーボード：→Next, ←Back, Space Play/Pause
- 色覚配慮のテーマ切替

8. 実装メモ
- アニメ管理: requestAnimationFrame + Promise を用い、各 action を逐次 await 再生して停止を実現
- スナップショットは差分のみ保持（メモリ節約: N ターン毎にフルスナップショット）
- ログの曖昧さ: 手札の正確復元が不可能なactionは raw を注記して「不確定」と表示

9. 優先実装事項（MVP）
- JSON読み込み → テーブルに初期配置表示
- Next/Back のターン単位操作（先攻→後攻の順で再生）
- アニメ: カードの移動・ダメージ表示・KO 表示
- ActionLog テキスト表示

参考イメージ  
- 添付スクリーンショット（卓上俯瞰）をレイアウトの基準に使用

以上。